language: none

build:
    pre_ci_boot:
        image_name: agssl123/vscodeextension
        image_tag: latest
        pull: true
        options: "-e HOME=/root"

    before_script:
        - mkdir -p shippable/testresults
        - ln -s ../target/test-reports shippable/testresults

    ci:
        - cd server/
        - sbt compile
        - sbt clean coverage test
        - sbt coverageReport
        - cd ..
        - cd extension
        - npm install typescript -g
        - npm install
        - npm run postinstall
        - "export DISPLAY=:99.0"
        - xvfb-run --server-args="-ac" npm test
        - cd ..
    post_ci:
        - ls ./server/target
        - ls ./server/target/scala-2.12
        - cp ./server/target/scala-2.12/scoverage-data ./shippable/codecoverage -r
        - cp ./server/target/scala-2.12/scoverage-report ./shippable/codecoverage -r